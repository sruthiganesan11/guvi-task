db.attendance.aggregate([
{
$lookup: {
from:"topics",
localField:"topic",
foreignField:"topic",
as:"Absentees"
}
},
{
$lookup: {
from:"tasks",
localField:"user",
foreignField:"user",
as:"Task Not Submitted"
}
},
{
$match: {
"Absentees.topic_date":{
$gte:"2020-10-15",
$lte:"2020-10-31"
},
"present":false
}
},
{
$match: {
"Task Not Submitted.due_date":{
$gte:"2020-10-15",
$lte:"2020-10-31"
},
"submitted":false
}
},
{
$group:{
_id:null,
count:{$sum:1}
}
}
])